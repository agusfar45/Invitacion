<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Confirmación de Asistencia</title>
  <style>
    :root {
      --primary: #0b2a4a;  /* azul marino */
      --accent: #8aa4c6;
      --silver: #c0c6d1;  /* plateado suave */
      --bg: #ffffff;
      --text: #1b1b1b;
    }
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
      color: var(--text);
      background: linear-gradient(180deg, #f7f9fc 0%, #ffffff 100%);
      min-height: 100dvh;
      display: grid;
      place-items: center;
      padding: 24px;
    }
    .card {
      width: 100%;
      max-width: 720px;
      background: var(--bg);
      border: 1px solid #e9eef5;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(11, 42, 74, 0.08);
      overflow: hidden;
    }
    .header {
      padding: 28px 24px 12px;
      background: radial-gradient(60% 80% at 0% 0%, rgba(11,42,74,.10), transparent 60%),
                  radial-gradient(60% 80% at 100% 0%, rgba(192,198,209,.20), transparent 60%),
                  linear-gradient(180deg, #ffffff, #f6f8fb);
      border-bottom: 1px solid #eef2f7;
    }
    h1 { margin: 0; font-size: 24px; color: var(--primary); }
    p.sub { margin: 6px 0 0; color: #4a5a6a; font-size: 14px; }
    form { padding: 20px 24px 28px; }
    .row { display: grid; gap: 14px; grid-template-columns: 1fr; }
    @media (min-width: 640px) {
      .row.cols-2 { grid-template-columns: 1fr 1fr; }
    }
    label { font-size: 13px; color: #2c3a49; }
    input, select, textarea {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid #e1e7ef;
      border-radius: 12px;
      background: #fff;
      font-size: 15px;
      outline: none;
      transition: border-color .2s, box-shadow .2s;
    }
    input:focus, select:focus, textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 4px rgba(138,164,198,.18);
    }
    .hint { font-size: 12px; color: #5f7389; margin-top: 6px; }
    .names-grid { display: grid; gap: 10px; margin-top: 12px; }
    @media (min-width: 560px) { .names-grid { grid-template-columns: 1fr 1fr; } }

    .btns { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px; }
    button, .ghost {
      appearance: none; border: none; cursor: pointer;
      padding: 12px 16px; border-radius: 12px; font-weight: 600; font-size: 15px;
    }
    button.primary {
      background: var(--primary); color: #fff;
      box-shadow: 0 6px 16px rgba(11, 42, 74, 0.25);
    }
    button.primary:disabled { opacity: .6; cursor: not-allowed; }
    a.ghost { background: #f2f5f9; color: #2c3a49; text-decoration: none; }

    .footer { padding: 14px 20px; border-top: 1px solid #eef2f7; font-size: 12px; color: #5f7389; display:flex;justify-content:space-between;align-items:center;gap:8px; flex-wrap:wrap; }
    code.small { background: #f3f6fb; padding: 4px 8px; border-radius: 8px; font-size: 12px; }

    /* decoración sutil de mariposas */
    .butterflies { position: absolute; inset: 0; pointer-events: none; }
    .bf { position: absolute; opacity: .25; filter: drop-shadow(0 2px 4px rgba(11,42,74,.2)); }
    .bf svg { width: 40px; height: 40px; fill: var(--primary); }
    .bf.silver svg { fill: var(--silver); }
  </style>
</head>
<body>
  <div class="card" role="region" aria-label="Formulario de confirmación de asistencia">
    <div class="header">
      <h1>Confirmación de asistencia</h1>
      <p class="sub">Completá tus datos y los de tu grupo. Al enviar, se abre WhatsApp con el mensaje listo para mandar.</p>
    </div>

    <form id="rsvpForm">
      <div class="row cols-2">
        <div>
          <label for="fullname">Nombre y apellido *</label>
          <input id="fullname" name="fullname" type="text" placeholder="Ej: Sofia Valentina Farfán" required />
        </div>
        <div>
          <label for="count">Cantidad de personas *</label>
          <input id="count" name="count" type="number" min="1" max="20" inputmode="numeric" value="1" required />
          <div class="hint">Incluyéndote.</div>
        </div>
      </div>

      <div style="margin-top: 12px;">
        <label>Nombre(s) de las personas</label>
        <div id="names" class="names-grid"></div>
        <div class="hint">Se generan campos según la cantidad indicada. Podés ajustar los nombres manualmente.</div>
      </div>

      <div class="row" style="margin-top: 12px;">
        <div>
          <label for="note">Mensaje opcional</label>
          <textarea id="note" name="note" rows="3" placeholder="Ej: Llegamos un poco más tarde…"></textarea>
        </div>
      </div>

      <div class="btns">
        <button type="submit" class="primary" id="sendBtn">Enviar por WhatsApp</button>
        <a class="ghost" href="#" id="previewLink" target="_blank" rel="noopener">Ver mensaje</a>
      </div>
    </form>

    <div class="footer">
      <span>Destino: <code class="small" id="phoneShow"></code></span>
      <span id="status" aria-live="polite"></span>
    </div>
  </div>

  <!-- mariposas decorativas -->
  <div class="butterflies" aria-hidden="true">
    <div class="bf" style="top:8%; left:6%; transform: rotate(-12deg);"><svg viewBox="0 0 24 24"><path d="M12 12c-1.5-3-5-6-8-6 0 3 3 6 6 7-1 2-4 3-6 3 1 2 5 2 8-1v-3zm0 0c1.5-3 5-6 8-6 0 3-3 6-6 7 1 2 4 3 6 3-1 2-5 2-8-1v-3z"/></svg></div>
    <div class="bf silver" style="bottom:10%; right:8%; transform: rotate(18deg);"><svg viewBox="0 0 24 24"><path d="M12 12c-1.5-3-5-6-8-6 0 3 3 6 6 7-1 2-4 3-6 3 1 2 5 2 8-1v-3zm0 0c1.5-3 5-6 8-6 0 3-3 6-6 7 1 2 4 3 6 3-1 2-5 2-8-1v-3z"/></svg></div>
  </div>

  <script>
    // ⚙️ Configuración: cambiá el número si lo necesitás.
    // Para móviles de Argentina en WhatsApp se recomienda 549 + código de área + número (sin 15).
    const WHATSAPP_PHONE = "+5493874833446"; // <- editá acá si hace falta

    const form = document.getElementById('rsvpForm');
    const namesWrap = document.getElementById('names');
    const countInput = document.getElementById('count');
    const fullInput = document.getElementById('fullname');
    const noteInput = document.getElementById('note');
    const previewLink = document.getElementById('previewLink');
    const phoneShow = document.getElementById('phoneShow');
    const status = document.getElementById('status');

    phoneShow.textContent = WHATSAPP_PHONE;

    function ensureFirstField() {
      // Garantiza que existe el campo #1 (titular) y que es de solo lectura
      if (!namesWrap.children[0]) {
        const inp = document.createElement('input');
        inp.type = 'text';
        inp.placeholder = 'Titular (Nombre y apellido #1)';
        inp.required = true;
        inp.readOnly = true;
        inp.dataset.idx = '0';
        namesWrap.appendChild(inp);
      }
      // sincroniza valor con el Nombre y apellido principal
      namesWrap.children[0].value = (fullInput.value || '').trim();
    }

    function syncNameFields() {
      const n = Math.max(1, Math.min(20, parseInt(countInput.value || '1', 10)));
      // Asegura el primer campo (titular)
      ensureFirstField();
      // Cantidad actual (incluyendo el primero)
      let current = namesWrap.children.length;
      // Agregar campos si faltan (a partir del índice 1)
      for (let i = current; i < n; i++) {
        const inp = document.createElement('input');
        inp.type = 'text';
        inp.placeholder = `Nombre y apellido #${i+1}`;
        inp.required = true;
        inp.autocomplete = 'name';
        inp.dataset.idx = String(i);
        namesWrap.appendChild(inp);
      }
      // Quitar campos si sobran
      for (let i = namesWrap.children.length; i > n; i--) {
        // nunca remover el índice 0 (titular)
        if (namesWrap.lastElementChild && namesWrap.lastElementChild.dataset.idx !== '0') {
          namesWrap.removeChild(namesWrap.lastElementChild);
        } else {
          break;
        }
      }
      updatePreviewLink();
    }

   function buildMessage() {
  const count = Math.max(1, Math.min(20, parseInt(countInput.value || '1', 10)));
  const allInputs = Array.from(namesWrap.querySelectorAll('input'));
  const names = allInputs.map(i => i.value.trim()).filter(Boolean);
  const titular = fullInput.value.trim();
  const nota = noteInput.value.trim();
  const lines = [];

  lines.push('CONFIRMACION DE ASISTENCIA\n'); // salto de línea
  lines.push(`Titular: ${titular}\n`);
  lines.push(`Personas: ${count}\n`);

  if (names.length) {
    lines.push('Listado:\n');
    lines.push(' - ' + names.join('\n - ') + '\n'); // cada nombre en nueva línea
  }

  if (nota) {
    lines.push('Mensaje:\n' + nota + '\n');
  }

  // Texto final del evento
  lines.push('Evento: 15 años\n');

  // unir con doble salto de línea para más espacio entre bloques
  return lines.join('\n');
}

    

    function buildWaLink() {
      const text = encodeURIComponent(buildMessage());
      return `https://api.whatsapp.com/send?phone=${WHATSAPP_PHONE}&text=${text}`;
    }

    function updatePreviewLink() {
      previewLink.href = buildWaLink();
    }

    // Eventos
    countInput.addEventListener('input', syncNameFields);
    fullInput.addEventListener('input', () => {
      ensureFirstField();
      updatePreviewLink();
    });
    noteInput.addEventListener('input', updatePreviewLink);
    namesWrap.addEventListener('input', updatePreviewLink);

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!form.reportValidity()) return;
      // sincroniza por las dudas antes de armar el link
      ensureFirstField();
      status.textContent = 'Preparando WhatsApp…';
      const link = buildWaLink();
      // Intentamos abrir en la misma pestaña (mejor en móviles)
      window.location.href = link;
    });

    // Inicialización
    syncNameFields();
    updatePreviewLink();
  </script>
</body>
</html>
